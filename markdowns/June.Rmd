---
title: "Meeting Notes"
author: "Andrea Odell"
date: "6/24/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/Users/andrea/Box/UC DAVIS/Oken Lab/lingcod-rockfish")
```

### June 24 2021

This week I went back to the lingcod dataset collected by Bonnie et al. and went through the data cleaning script "clean.R". Updated a few things to make the dataset more tidy. Created new total Sebastes by number and by weight columns by summing all sebastes species into one total sebastes (X..Sebastes.Total and wt..Sebastes.Total). Then, I updated the code that predicts age given lengths to make it more efficient and more based on the data. 

The predicted ages seem to be biased downwards compared to the age data available (e.g. predicted age of 5 compared to age given as 6). Should I try to correct for this bias? 

```{r load in data, echo = FALSE, message = FALSE}
library(tidyverse)
load("cleaned_data/lingcod_rockfish.Rdata")
load("cleaned_data/lingcod_rockfish_CA.Rdata")
```

To determine diet fraction, I created a new dataset "lingcod_rockfish_CA" which only looks at fish caught off ports within California. This reduced the number of observations from 1320 to 561. To calculate the fraction of lingcod diet that is rockfish, I simply divided the total Sebastes weight/number by the total weight/number of all gut contents for each lingcod individual. Below is a table with the average of these proportions for each lingcod age. There's quite a bit of variation to this number though, as there are a lot of 0s and several 1s in the diet fraction. 

```{r diet fraction, echo=FALSE, message = FALSE, warning = FALSE}
# Dataframe with the average diet fraction by weight that is sebastes for each age and sex 
dietfrac_by_age_wt <- lingcod_rockfish_CA %>% 
  group_by(Sex.1, age_useful) %>% 
  summarise(mean = mean(gut.ratio.sebastes.wt), sd = sd(gut.ratio.sebastes.wt), 
            n = n(), max = max(gut.ratio.sebastes.wt), min = min(gut.ratio.sebastes.wt))
dietfrac_by_age_wt$sd[is.na(dietfrac_by_age_wt$sd)] <- 0
dietfrac_by_age_wt

# Dataframe with the average diet fraction by number that is sebastes for each age and sex 
dietfrac_by_age_X <- lingcod_rockfish_CA %>% 
  group_by(Sex.1, age_useful) %>% 
  summarise(mean = mean(gut.ratio.sebastes.X), sd = sd(gut.ratio.sebastes.X), n = n())
dietfrac_by_age_X$sd[is.na(dietfrac_by_age_X$sd)] <- 0

# The proportion of stomachs that contained rockfish of all the stomachs
perc.occurrence <- (sum(lingcod_rockfish_CA$X..Sebastes.Total > 0)/nrow(lingcod_rockfish_CA))*100

### Proportion of gut content that is Sebastes across Ages
  # males
ggplot(lingcod_rockfish_CA[which(lingcod_rockfish_CA$Sex.1 == "M"),], aes(age_useful, gut.ratio.sebastes.wt)) +
  geom_point(color = "cyan3") +
  theme_classic() +
  labs( x = "Lingcod Age", y = "Fraction of diet that is Sebastes", title = "Male") +
  xlim(0,17)
  # females
ggplot(lingcod_rockfish_CA[which(lingcod_rockfish_CA$Sex.1 == "F"),], aes(age_useful, gut.ratio.sebastes.wt)) +
  geom_point(color = "lightcoral") +
  theme_classic() +
  labs( x = "Lingcod Age", y = "Fraction of diet that is Sebastes", title = "Female") +
  xlim(0,17)

#graphing the mean diet fraction by age
ggplot(dietfrac_by_age_wt, aes(age_useful, mean, col = Sex.1)) +
  geom_point() +
  labs( x = "Lingcod Age", y = "Average fraction of diet that is Sebastes") +
  theme_classic()
```


%O = 13% This is the proportion of stomachs that contained rockfish of all the stomachs  
%OF = 17.0% for females  
%OM = 10.7% for males  

How do I deal with ages that have 0 sebastes diet fraction (resulting from small sample size or even just bad timing). Should I try to fit a distribution to this data after removing the 0 in the older age classes? Should I bootstrap within age classes?

To add the lingcod consumption to the rockfish dynamic model, I calculate consumption as 

$Q =\sum_{s} \sum_{a_l=1}^{l} P_{a_l} L_{a_l,s}$ 

where $P$ is a vector of the proportion of lingcod diet that is composed of Sebastes by lingcod age.


